# Как запустить ЛР7 (пошагово для новичка)

## Если хотите «всё за один раз»
1. Установите PostgreSQL (можно через Docker), JDK 17 и Maven 3+.
   - Docker пример: `docker run --name lab7-db -e POSTGRES_PASSWORD=123456789 -p 5432:5432 -d postgres:15`
   - Без Docker можно обойтись встроенной файловой H2: добавьте `USE_H2=1` к скрипту ниже, БД сохранится в `LBOOP7-manual/lab7-local-db.mv.db`.
2. Откройте терминал в корне репозитория и выполните:
   ```bash
   cd LBOOP7-manual
   DB_USER=postgres DB_PASSWORD=123456789 ./run_lab7.sh
   ```
   Скрипт применит SQL-таблицы, соберёт WAR и запустит сервер через `spring-boot:run` (Ctrl+C — остановка). Переменные `DB_HOST/DB_PORT/DB_NAME/DB_USER/DB_PASSWORD` (или `DB_URL`) настраиваются через окружение. Если таблиц нет, сервер сам применит SQL из `src/main/resources/scripts/tables/` при старте.
   - Если хотите сразу видеть локальную базу без PostgreSQL, запустите `USE_H2=1 ./run_lab7.sh` или задайте `DB_URL=jdbc:h2:file:./lab7-local-db;AUTO_SERVER=TRUE`. После старта файл `lab7-local-db.mv.db` можно открыть через H2 Console (`java -jar h2*.jar`, URL как выше, user: sa, без пароля).

   > Совет: в корне лежит `.mvn/maven.config` (по одному аргументу на строку), поэтому достаточно одной команды из корня: `mvn spring-boot:run -DskipTests` — Maven сам выберет модуль `LBOOP7-manual`.

## Подробно и вручную
### 1. Подготовьте базу данных
- Создайте пустую БД (по умолчанию используется `postgres`).
- (Необязательно) Выполните SQL-скрипты таблиц из `src/main/resources/scripts/tables/` в порядке users_table.sql → function_table.sql → points_table.sql → composite_function_table.sql → composite_function_link_table.sql → performance_table.sql → sorting_performance_table.sql, если хотите подготовить БД вручную. Сервер выполнит те же скрипты автоматически при запуске. Используйте переменные окружения `DB_HOST/DB_PORT/DB_NAME/DB_USER/DB_PASSWORD` или единый `DB_URL=jdbc:postgresql://host:port/db` — сервер возьмёт их автоматически.

### 2. Соберите и запустите сервер
- Выполните сборку (интернет обязателен для скачивания зависимостей):
  ```bash
  mvn clean package -DskipTests
  mvn -pl LBOOP7-manual -am package -DskipTests
  ```
- Запустите встроенный сервер (или разверните WAR на Tomcat 10+):
  ```bash
  mvn -pl LBOOP7-manual -am spring-boot:run -DskipTests
  ```
  Сервлеты и статика будут доступны по умолчанию на http://localhost:8080/.

### 3. Откройте интерфейс
- Начинайте с http://localhost:8080/auth.html — здесь логин, регистрация и кнопка «Оффлайн». После успешного шага страница автоматически переходит на основной экран.
- Основной UI остаётся на http://localhost:8080/index.html (фабрика, функции, операции, график и т.д.).

### 4. Зарегистрируйтесь или войдите
- На `auth.html` введите логин/пароль и нажмите «Зарегистрироваться» (POST `/users` с проверкой пароля). После успеха страница сама выполнит вход через `/auth/login` и вернёт вас на основную страницу.
- Для входа без регистрации используйте вкладку «Войти» (POST `/auth/login`), при ошибке БД появится понятное сообщение.
- После входа на главной странице нажмите «Синхронизировать», чтобы подтянуть сохранённые функции и точки с сервера.

### 5. Создайте табулированную функцию из точек
- В «Создать функцию из точек» впишите имя, добавьте строки кнопкой «Добавить строку», заполните X/Y и нажмите «Создать». Таблица запоминает строки, можно перетасовать точки кнопкой «D20: перемешать» для пасхалки.

### 6. Создайте функцию из базовой
- В «Создать функцию из базовой» выберите простую функцию (список заполняется кнопкой «Сканировать заклинания»), задайте имя, интервал `a;b` и число точек, нажмите «Создать».

### 7. Делайте операции и производные
- В «Операции над функциями» выберите две функции и нажмите нужную операцию (сложение/вычитание/умножение/деление). Для редактируемых функций доступны «Вставка точки»/«Удалить точку». Результат сохраняется, если вы авторизованы.
- В «Дифференцирование» выберите функцию и нажмите «Дифференцировать» — создаётся производная.
- В «Интеграл» выберите функцию, укажите число потоков (1–16) и нажмите «Вычислить». Результат выдаётся числом.

### 8. График и apply()
- В разделе «График функции и apply()» выберите функцию, нажмите «Обновить график», чтобы увидеть кривую. Поле `X для apply()` + кнопка «Вычислить» покажут значение функции в точке и отметят подсказкой на графике. Наведите мышь на график для подсказок по точкам.

### 9. Композитные функции
- В «Сложные функции (Composite)» добавляйте шаги кнопкой «Добавить шаг» (каждый шаг — функция из списка). Нажмите «Собрать», чтобы построить композицию; она добавится в список доступных базовых функций.

### 10. Файлы и тесты
- В блоке «Файлы» выберите функцию, формат (JSON/XML) и нажмите «Сохранить». Кнопка «Загрузить» принимает файл с диска и добавляет функцию в список.
- В блоке «Тесты» нажмите «Запустить тесты», чтобы открыть `assets/tests.html` и проверить клиентскую логику в браузере. Кнопка «Бросить D20» — ещё одна D&D пасхалка.

## Что делать после запуска
- Все API эндпоинты защищены Basic Auth, кроме статики и POST `/users` (регистрация). Переключатель фабрик влияет на способ табулирования в новых функциях. Модальные окна сообщают об ошибках (некорректный ввод, 401 и т.п.).
- Интерфейс адаптивный и в тёмной «подземельной» теме; переключатель «Тёмная тема» можно отключить при желании.
