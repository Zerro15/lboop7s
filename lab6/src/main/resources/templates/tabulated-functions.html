<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–§—É–Ω–∫—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞</title>
    <style>
        :root {
            color-scheme: light dark;
        }
        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
            background: radial-gradient(circle at 10% 20%, #f5f7fb 0, #eef2ff 22%, #f8fafc 45%, #ffffff 100%);
            color: #0f172a;
            line-height: 1.55;
        }
        header {
            padding: 20px 24px;
            background: linear-gradient(120deg, #0b65c2, #2563eb);
            color: #fff;
            box-shadow: 0 10px 30px rgba(11, 101, 194, 0.25);
        }
        header h1 { margin: 0 0 6px; font-size: 26px; }
        header p { margin: 0; max-width: 780px; opacity: 0.9; }
        main {
            max-width: 1100px;
            margin: 20px auto 64px;
            padding: 0 16px;
            display: grid;
            gap: 16px;
        }
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 14px;
            padding: 18px;
            box-shadow: 0 10px 40px rgba(15, 23, 42, 0.05);
            border: 1px solid #e5e7eb;
        }
        h2 { margin-top: 0; margin-bottom: 6px; }
        .subtext { color: #475569; margin-top: 0; margin-bottom: 14px; }
        label { font-weight: 600; display: block; margin-bottom: 6px; }
        input, select, textarea, button {
            width: 100%;
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid #d4d7dd;
            font-size: 14px;
            background: #fff;
        }
        textarea { resize: vertical; min-height: 110px; }
        button {
            background: #0b65c2;
            color: #fff;
            cursor: pointer;
            border: none;
            font-weight: 700;
            letter-spacing: 0.01em;
        }
        button.secondary { background: #f4f6fb; color: #0f172a; border: 1px solid #d4d7dd; }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
        .row { display: grid; gap: 12px; }
        .row.cols-2 { grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
        .pill { display: inline-flex; padding: 6px 12px; border-radius: 999px; background: #e0f2fe; color: #0b65c2; font-weight: 700; }
        .list { display: grid; gap: 10px; margin-top: 8px; }
        .item {
            border: 1px dashed #d7dde6;
            border-radius: 12px;
            padding: 12px;
            background: #f9fbff;
        }
        .item h4 { margin: 0 0 6px; }
        .muted { color: #6b7280; }
        .actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .inline { display: inline-flex; gap: 8px; align-items: center; }
        .info-banner {
            border-left: 4px solid #0ea5e9;
            padding: 10px 12px;
            background: #f0f9ff;
            border-radius: 8px;
            color: #0f172a;
            margin: 8px 0 0;
        }
        .chip { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; background: #eef2ff; border-radius: 999px; font-weight: 600; }
        .value-list { margin: 8px 0 0; padding-left: 16px; color: #0f172a; }
        .value-list li { margin-bottom: 4px; }
        .tag { background: #ecfeff; color: #0f172a; padding: 4px 8px; border-radius: 8px; border: 1px solid #a5f3fc; font-weight: 700; }
        .result-box { padding: 10px; border-radius: 10px; background: #f7fee7; border: 1px solid #d9f99d; margin-top: 8px; font-weight: 700; }
        details summary { cursor: pointer; font-weight: 700; }
        @media (prefers-color-scheme: dark) {
            body { background: #0b1220; color: #e5e7eb; }
            .card { background: #0f172a; border-color: #1f2937; box-shadow: none; }
            input, select, textarea { background: #0b162b; border-color: #1f2937; color: #e5e7eb; }
            button.secondary { background: #111827; color: #e5e7eb; border-color: #1f2937; }
            .item { background: #0b162b; border-color: #1f2937; }
            .info-banner { background: #0b2742; border-left-color: #38bdf8; }
        }
    </style>
</head>
<body>
<header>
    <h1>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Ñ—É–Ω–∫—Ü–∏–π –±–µ–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</h1>
    <p>–í—Å–µ –¥–∞–Ω–Ω—ã–µ –∂–∏–≤—É—Ç —Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏ –≤–∞—à–µ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞. –ó–∞–∫—Ä—ã—Ç–∏–µ –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—á–∏—â–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ.</p>
</header>
<main>
    <section class="card">
        <h2>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</h2>
        <p class="subtext">–ù–∏–∫–∞–∫–∏—Ö —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —Ç–∞–±–ª–∏—Ü: –≤–≤–æ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é, —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –∏ —Å—Ä–∞–∑—É –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ –∫ —Ä–∞—Å—á—ë—Ç–∞–º.</p>
        <div class="info-banner">
            <span class="chip">üß† –ü–∞–º—è—Ç—å –±—Ä–∞—É–∑–µ—Ä–∞</span>
            <span>–í—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å—á–µ–∑–Ω—É—Ç –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –≤–∫–ª–∞–¥–∫–∏. –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Ç–æ—á–µ—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–π —Ç–æ–ª—å–∫–æ –Ω–∞ –≤—Ä–µ–º—è —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏.</span>
        </div>
    </section>

    <section class="card">
        <h2>–°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ —Ç–æ—á–∫–∞–º</h2>
        <p class="subtext">–í–≤–µ–¥–∏—Ç–µ X –∏ Y —á–µ—Ä–µ–∑ —Ç–æ—á–∫—É —Å –∑–∞–ø—è—Ç–æ–π –∏–ª–∏ –ø—Ä–æ–±–µ–ª, –∫–∞–∂–¥–∞—è –ø–∞—Ä–∞ ‚Äî –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ.</p>
        <form id="points-form" class="row">
            <div class="row cols-2">
                <div>
                    <label for="points-name">–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏</label>
                    <input id="points-name" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –†—É—á–Ω–∞—è —Å–µ—Ç–∫–∞" />
                </div>
                <div>
                    <label for="points-origin">–û–ø–∏—Å–∞–Ω–∏–µ/–ø–æ–º–µ—Ç–∫–∞</label>
                    <input id="points-origin" placeholder="–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö" />
                </div>
            </div>
            <div>
                <label for="points-source">–ó–Ω–∞—á–µ–Ω–∏—è</label>
                <textarea id="points-source" placeholder="0;0\n1;2\n2;4"></textarea>
            </div>
            <div class="actions">
                <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –≤ –ø–∞–º—è—Ç–∏</button>
                <button type="button" class="secondary" id="clear-points">–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª—è</button>
            </div>
        </form>
    </section>

    <section class="card">
        <h2>–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ñ–æ—Ä–º—É–ª–µ</h2>
        <p class="subtext">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ—á–µ–∫ –Ω–∞ –æ—Ç—Ä–µ–∑–∫–µ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ: –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º—É–ª—É, –∑–∞–¥–∞–π—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω –∏ —à–∞–≥–æ–≤.</p>
        <form id="formula-form" class="row">
            <div class="row cols-2">
                <div>
                    <label for="formula-name">–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏</label>
                    <input id="formula-name" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, sin(x)" />
                </div>
                <div>
                    <label for="formula-key">–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è</label>
                    <select id="formula-key">
                        <option value="sin">sin(x)</option>
                        <option value="cos">cos(x)</option>
                        <option value="exp">exp(x)</option>
                        <option value="sqr">x^2</option>
                        <option value="log">ln(x)</option>
                        <option value="identity">x</option>
                    </select>
                </div>
            </div>
            <div class="row cols-2">
                <div>
                    <label for="formula-left">–õ–µ–≤–∞—è –≥—Ä–∞–Ω–∏—Ü–∞</label>
                    <input id="formula-left" type="number" step="any" value="0" />
                </div>
                <div>
                    <label for="formula-right">–ü—Ä–∞–≤–∞—è –≥—Ä–∞–Ω–∏—Ü–∞</label>
                    <input id="formula-right" type="number" step="any" value="6.283" />
                </div>
                <div>
                    <label for="formula-count">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫</label>
                    <input id="formula-count" type="number" min="2" value="12" />
                </div>
                <div class="inline" style="margin-top: 26px;">
                    <input id="formula-degrees" type="checkbox" style="width:auto;" />
                    <label for="formula-degrees" style="margin:0; font-weight:500;">–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∫–∞–∫ –≥—Ä–∞–¥—É—Å—ã (–¥–ª—è sin/cos)</label>
                </div>
            </div>
            <div class="actions">
                <button type="submit">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </section>

    <section class="card">
        <h2>–ë—ã—Å—Ç—Ä—ã–µ —Ä–∞—Å—á—ë—Ç—ã</h2>
        <p class="subtext">–†–∞–±–æ—Ç–∞–π—Ç–µ —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –∏–ª–∏ –≤—ã—á–∏—Å–ª—è–π—Ç–µ —Ç—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—é –ø–æ —É–≥–ª—É.</p>
        <div class="row cols-2">
            <form id="evaluate-form" class="row">
                <label for="evaluate-select">–§—É–Ω–∫—Ü–∏—è –∏–∑ –ø–∞–º—è—Ç–∏</label>
                <select id="evaluate-select"></select>
                <label for="evaluate-x">–ó–Ω–∞—á–µ–Ω–∏–µ X</label>
                <input id="evaluate-x" type="number" step="any" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 1.5" />
                <button type="submit">–í—ã—á–∏—Å–ª–∏—Ç—å f(x)</button>
                <div class="result-box" id="evaluate-result">–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å</div>
            </form>
            <form id="angle-form" class="row">
                <label for="angle-fn">–¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è –ø–æ —É–≥–ª—É</label>
                <select id="angle-fn">
                    <option value="sin">sin(—É–≥–æ–ª)</option>
                    <option value="cos">cos(—É–≥–æ–ª)</option>
                    <option value="tan">tan(—É–≥–æ–ª)</option>
                </select>
                <label for="angle-value">–£–≥–æ–ª –≤ –≥—Ä–∞–¥—É—Å–∞—Ö</label>
                <input id="angle-value" type="number" step="any" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 45" />
                <button type="submit">–ü–æ—Å—á–∏—Ç–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ</button>
                <div class="result-box" id="angle-result">–û–∂–∏–¥–∞–µ—Ç –≤–≤–æ–¥–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</div>
            </form>
        </div>
    </section>

    <section class="card">
        <h2>–ë–∏–Ω–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–∞–¥ —Ñ—É–Ω–∫—Ü–∏—è–º–∏</h2>
        <p class="subtext">–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è. X-–∑–Ω–∞—á–µ–Ω–∏—è –±–µ—Ä—É—Ç—Å—è –ø–æ–ø–∞—Ä–Ω–æ –ø–æ –∏–Ω–¥–µ–∫—Å—É, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä—ë–º —Ç–æ—á–µ–∫ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
        <form id="operation-form" class="row cols-2">
            <div>
                <label for="op-a">–§—É–Ω–∫—Ü–∏—è A</label>
                <select id="op-a"></select>
            </div>
            <div>
                <label for="op-b">–§—É–Ω–∫—Ü–∏—è B</label>
                <select id="op-b"></select>
            </div>
            <div>
                <label for="op-type">–û–ø–µ—Ä–∞—Ü–∏—è</label>
                <select id="op-type">
                    <option value="add">–°–ª–æ–∂–µ–Ω–∏–µ (Y1 + Y2)</option>
                    <option value="subtract">–í—ã—á–∏—Ç–∞–Ω–∏–µ (Y1 - Y2)</option>
                    <option value="multiply">–£–º–Ω–æ–∂–µ–Ω–∏–µ (Y1 * Y2)</option>
                    <option value="divide">–î–µ–ª–µ–Ω–∏–µ (Y1 / Y2)</option>
                </select>
            </div>
            <div>
                <label for="op-name">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</label>
                <input id="op-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, A+B" />
            </div>
            <div class="actions">
                <button type="submit">–°–æ–∑–¥–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é</button>
            </div>
        </form>
    </section>

    <section class="card">
        <h2>–§—É–Ω–∫—Ü–∏–∏, —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç–∏</h2>
        <p class="subtext">–ù–∏–∫–∞–∫–∏—Ö —Ç–∞–±–ª–∏—Ü: –∫–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞—Ä—Ç–æ—á–∫–æ–π —Å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º —Å–ø–∏—Å–∫–æ–º –∑–Ω–∞—á–µ–Ω–∏–π.</p>
        <div id="functions-list" class="list"></div>
    </section>
</main>

<script>
    const state = {
        functions: [],
        counter: 1,
    };

    const pointsForm = document.getElementById('points-form');
    const pointsNameInput = document.getElementById('points-name');
    const pointsOriginInput = document.getElementById('points-origin');
    const pointsSourceInput = document.getElementById('points-source');
    const clearPointsButton = document.getElementById('clear-points');
    const formulaForm = document.getElementById('formula-form');
    const evaluateForm = document.getElementById('evaluate-form');
    const evaluateSelect = document.getElementById('evaluate-select');
    const evaluateInput = document.getElementById('evaluate-x');
    const evaluateResult = document.getElementById('evaluate-result');
    const angleForm = document.getElementById('angle-form');
    const angleResult = document.getElementById('angle-result');
    const operationForm = document.getElementById('operation-form');
    const opASelect = document.getElementById('op-a');
    const opBSelect = document.getElementById('op-b');
    const opTypeSelect = document.getElementById('op-type');
    const opNameInput = document.getElementById('op-name');
    const functionsList = document.getElementById('functions-list');

    function parsePairs(source) {
        return source
            .split(/\n+/)
            .map((line) => line.trim())
            .filter(Boolean)
            .map((line) => {
                const [xRaw, yRaw] = line.split(/[;\s,]+/);
                const x = Number(xRaw);
                const y = Number(yRaw);
                if (Number.isNaN(x) || Number.isNaN(y)) {
                    throw new Error('–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–≤–∞ —á–∏—Å–ª–∞ X –∏ Y.');
                }
                return { x, y };
            })
            .sort((a, b) => a.x - b.x);
    }

    function degToRad(value) {
        return value * Math.PI / 180;
    }

    function buildMathPoint(key, x, useDegrees) {
        const input = (useDegrees && (key === 'sin' || key === 'cos' || key === 'tan')) ? degToRad(x) : x;
        switch (key) {
            case 'sin': return { x, y: Math.sin(input) };
            case 'cos': return { x, y: Math.cos(input) };
            case 'tan': return { x, y: Math.tan(input) };
            case 'exp': return { x, y: Math.exp(input) };
            case 'sqr': return { x, y: input * input };
            case 'log': return { x, y: Math.log(input) };
            default: return { x, y: input };
        }
    }

    function generatePointsFromFormula(key, count, left, right, useDegrees) {
        if (count < 2) {
            throw new Error('–ù—É–∂–Ω–æ –Ω–µ –º–µ–Ω—å—à–µ –¥–≤—É—Ö —Ç–æ—á–µ–∫.');
        }
        if (right < left) {
            throw new Error('–ü—Ä–∞–≤–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–∞ –ª–µ–≤–æ–π.');
        }
        const step = count === 1 ? 0 : (right - left) / (count - 1);
        const result = [];
        for (let i = 0; i < count; i += 1) {
            const x = left + step * i;
            result.push(buildMathPoint(key, x, useDegrees));
        }
        return result;
    }

    function addFunction(name, points, origin = '') {
        const id = state.counter++;
        state.functions.push({ id, name: name || `–§—É–Ω–∫—Ü–∏—è ${id}`, points, origin: origin || '–ë–µ–∑ –ø–æ–º–µ—Ç–∫–∏' });
        renderFunctionOptions();
        renderFunctionCards();
    }

    function removeFunction(id) {
        state.functions = state.functions.filter((fn) => fn.id !== id);
        renderFunctionOptions();
        renderFunctionCards();
    }

    function renderFunctionOptions() {
        const selects = [evaluateSelect, opASelect, opBSelect];
        selects.forEach((select) => {
            if (!select) return;
            select.innerHTML = '';
            const placeholder = document.createElement('option');
            placeholder.value = '';
            placeholder.textContent = state.functions.length === 0 ? '–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é' : '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é';
            placeholder.disabled = state.functions.length > 0;
            placeholder.selected = true;
            select.appendChild(placeholder);
            state.functions.forEach((fn) => {
                const option = document.createElement('option');
                option.value = fn.id;
                option.textContent = `${fn.name} (${fn.points.length} —Ç–æ—á–µ–∫)`;
                select.appendChild(option);
            });
        });
    }

    function renderFunctionCards() {
        functionsList.innerHTML = '';
        if (state.functions.length === 0) {
            const empty = document.createElement('div');
            empty.className = 'muted';
            empty.textContent = '–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –ø–æ —Ç–æ—á–∫–∞–º –∏–ª–∏ —Ñ–æ—Ä–º—É–ª–µ.';
            functionsList.appendChild(empty);
            return;
        }
        state.functions.forEach((fn) => {
            const card = document.createElement('div');
            card.className = 'item';
            const title = document.createElement('h4');
            title.textContent = fn.name;
            const meta = document.createElement('div');
            meta.className = 'muted';
            meta.textContent = `${fn.points.length} —Ç–æ—á–µ–∫ ‚Ä¢ ${fn.origin}`;
            const details = document.createElement('details');
            const summary = document.createElement('summary');
            summary.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è X –∏ Y';
            const list = document.createElement('ul');
            list.className = 'value-list';
            fn.points.forEach((p) => {
                const li = document.createElement('li');
                li.textContent = `x=${p.x}, y=${p.y}`;
                list.appendChild(li);
            });
            details.appendChild(summary);
            details.appendChild(list);
            const actions = document.createElement('div');
            actions.className = 'actions';
            const pickBtn = document.createElement('button');
            pickBtn.type = 'button';
            pickBtn.textContent = '–°–¥–µ–ª–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–π –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞—Ö';
            pickBtn.addEventListener('click', () => {
                evaluateSelect.value = fn.id;
                opASelect.value = fn.id;
            });
            const removeBtn = document.createElement('button');
            removeBtn.type = 'button';
            removeBtn.className = 'secondary';
            removeBtn.textContent = '–£–¥–∞–ª–∏—Ç—å';
            removeBtn.addEventListener('click', () => removeFunction(fn.id));
            actions.appendChild(pickBtn);
            actions.appendChild(removeBtn);

            card.appendChild(title);
            card.appendChild(meta);
            card.appendChild(details);
            card.appendChild(actions);
            functionsList.appendChild(card);
        });
    }

    function linearInterpolate(points, x) {
        if (!points || points.length === 0) {
            throw new Error('–ù–µ—Ç —Ç–æ—á–µ–∫ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è.');
        }
        if (points.length === 1) {
            return points[0].y;
        }
        const sorted = [...points].sort((a, b) => a.x - b.x);
        if (x <= sorted[0].x) return sorted[0].y;
        if (x >= sorted[sorted.length - 1].x) return sorted[sorted.length - 1].y;
        for (let i = 0; i < sorted.length - 1; i += 1) {
            const left = sorted[i];
            const right = sorted[i + 1];
            if (x >= left.x && x <= right.x) {
                const ratio = (x - left.x) / (right.x - left.x);
                return left.y + ratio * (right.y - left.y);
            }
        }
        return sorted[sorted.length - 1].y;
    }

    function handlePointsSubmit(event) {
        event.preventDefault();
        try {
            const name = pointsNameInput.value.trim();
            const origin = pointsOriginInput.value.trim();
            const points = parsePairs(pointsSourceInput.value);
            addFunction(name, points, origin);
            pointsSourceInput.value = '';
            pointsOriginInput.value = '';
        } catch (err) {
            alert(err.message);
        }
    }

    function handleFormulaSubmit(event) {
        event.preventDefault();
        const name = document.getElementById('formula-name').value.trim();
        const key = document.getElementById('formula-key').value;
        const left = Number(document.getElementById('formula-left').value);
        const right = Number(document.getElementById('formula-right').value);
        const count = Number(document.getElementById('formula-count').value);
        const useDegrees = document.getElementById('formula-degrees').checked;
        try {
            const points = generatePointsFromFormula(key, count, left, right, useDegrees);
            addFunction(name, points, `–§–æ—Ä–º—É–ª–∞ ${key}${useDegrees ? ' (—É–≥–ª—ã –≤ –≥—Ä–∞–¥—É—Å–∞—Ö)' : ''}`);
        } catch (err) {
            alert(err.message);
        }
    }

    function handleEvaluate(event) {
        event.preventDefault();
        const fnId = Number(evaluateSelect.value);
        const x = Number(evaluateInput.value);
        const fn = state.functions.find((f) => f.id === fnId);
        if (!fn) {
            evaluateResult.textContent = '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é.';
            return;
        }
        if (Number.isNaN(x)) {
            evaluateResult.textContent = '–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ X.';
            return;
        }
        try {
            const y = linearInterpolate(fn.points, x);
            evaluateResult.textContent = `f(${x}) = ${y}`;
        } catch (err) {
            evaluateResult.textContent = err.message;
        }
    }

    function handleAngle(event) {
        event.preventDefault();
        const key = document.getElementById('angle-fn').value;
        const angle = Number(document.getElementById('angle-value').value);
        if (Number.isNaN(angle)) {
            angleResult.textContent = '–í–≤–µ–¥–∏—Ç–µ —É–≥–æ–ª –≤ –≥—Ä–∞–¥—É—Å–∞—Ö.';
            return;
        }
        const point = buildMathPoint(key, angle, true);
        angleResult.textContent = `${key}(${angle}¬∞) = ${point.y}`;
    }

    function handleOperation(event) {
        event.preventDefault();
        const aId = Number(opASelect.value);
        const bId = Number(opBSelect.value);
        const type = opTypeSelect.value;
        const name = opNameInput.value.trim() || `–†–µ–∑—É–ª—å—Ç–∞—Ç ${type}`;
        const fnA = state.functions.find((f) => f.id === aId);
        const fnB = state.functions.find((f) => f.id === bId);
        if (!fnA || !fnB) {
            alert('–í—ã–±–µ—Ä–∏—Ç–µ –æ–±–µ —Ñ—É–Ω–∫—Ü–∏–∏.');
            return;
        }
        const limit = Math.min(fnA.points.length, fnB.points.length);
        if (limit === 0) {
            alert('–ù–µ—Ç —Ç–æ—á–µ–∫ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–∏.');
            return;
        }
        const points = [];
        for (let i = 0; i < limit; i += 1) {
            const left = fnA.points[i];
            const right = fnB.points[i];
            let y = 0;
            switch (type) {
                case 'add': y = left.y + right.y; break;
                case 'subtract': y = left.y - right.y; break;
                case 'multiply': y = left.y * right.y; break;
                case 'divide': y = right.y === 0 ? NaN : left.y / right.y; break;
                default: y = left.y;
            }
            points.push({ x: left.x, y });
        }
        addFunction(name, points, `–û–ø–µ—Ä–∞—Ü–∏—è ${type}`);
    }

    function init() {
        pointsForm.addEventListener('submit', handlePointsSubmit);
        clearPointsButton.addEventListener('click', () => {
            pointsSourceInput.value = '';
            pointsOriginInput.value = '';
            pointsNameInput.value = '';
        });
        formulaForm.addEventListener('submit', handleFormulaSubmit);
        evaluateForm.addEventListener('submit', handleEvaluate);
        angleForm.addEventListener('submit', handleAngle);
        operationForm.addEventListener('submit', handleOperation);
        renderFunctionOptions();
        renderFunctionCards();
    }

    document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
